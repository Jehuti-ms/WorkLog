<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkLog - Student Progress Tracker</title>
    
    <!-- Import Map for Firebase -->
    <script type="importmap">
        {
            "imports": {
                "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
                "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"
            }
        }
    </script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="auth.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š WorkLog</h1>
            <p class="subtitle">Student Progress & Hours Tracker</p>
            
            <!-- Storage Status -->
            <div class="storage-status">
                <span class="status" id="storageStatus">ğŸ“¦ Local Storage: Ready</span>
                <span class="status" id="syncStatus">â˜ï¸ Cloud: Disconnected</span>
            </div>
            
            <!-- Auth Section -->
            <div class="auth-section" style="position: relative;">
                <button class="btn" id="authButton" onclick="window.location.href='auth.html'">ğŸ” Login</button>
                <div class="user-menu" id="userMenu">
                    <div class="user-info" id="userName">Loading...</div>
                    <button class="user-menu-item" onclick="showProfileModal()">ğŸ‘¤ Profile</button>
                    <button class="user-menu-item" onclick="exportUserData()">ğŸ“¤ Export Data</button>
                    <button class="user-menu-item" onclick="logout()">ğŸšª Logout</button>
                </div>
            </div>
        </div>

        <!-- Cloud Sync Bar -->
        <div class="cloud-sync-bar" id="cloudSyncBar">
            <div class="sync-status">
                <span class="sync-indicator sync-offline" id="syncIndicator"></span>
                <span class="sync-status-text" id="syncStatusText">Not connected</span>
            </div>
            
            <div class="sync-controls">
                <div class="sync-options">
                    <label class="auto-sync-label">
                        <input type="checkbox" id="autoSyncCheckbox">
                        <span class="custom-checkbox"></span>
                        Auto-sync
                    </label>
                    <button class="btn-sm btn-secondary" onclick="syncNow()">ğŸ”„ Sync Now</button>
                </div>
                
                <div class="app-controls">
                    <button class="btn-sm btn-success" onclick="backupToCloud()">â˜ï¸ Backup</button>
                    <button class="btn-sm btn-warning" onclick="restoreFromCloud()">ğŸ“¥ Restore</button>
                    <button class="btn-sm btn-info" onclick="viewSyncStats()">ğŸ“Š Stats</button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab" data-tab="students">ğŸ‘¥ Students</button>
                <button class="tab" data-tab="hours">â±ï¸ Hours</button>
                <button class="tab" data-tab="marks">ğŸ“ Marks</button>
                <button class="tab" data-tab="attendance">ğŸ“… Attendance</button>
                <button class="tab" data-tab="payments">ğŸ’° Payments</button>
                <button class="tab" data-tab="reports">ğŸ“ˆ Reports</button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content" id="content">
            <!-- Students Tab -->
            <div class="tab-content" id="students">
                <div class="section-header">
                    <h2>ğŸ‘¥ Student Management</h2>
                    <div class="student-stats">
                        <span class="stat-badge" id="studentsCount">0</span>
                        <span class="stat-divider">|</span>
                        <span class="stat-text">Avg Rate: <span id="avgRate">$0.00</span></span>
                    </div>
                </div>

                <div class="default-rate-panel">
                    <h4>âš™ï¸ Default Hourly Rate</h4>
                    <div class="form-group">
                        <label>Default Rate ($/hour)</label>
                        <div class="rate-input-wrapper">
                            <span class="currency-symbol">$</span>
                            <input type="number" id="defaultBaseRate" step="0.01" min="0" value="25.00">
                            <span class="rate-suffix">/hour</span>
                        </div>
                        <small class="help-text">This rate will be pre-filled for new students</small>
                    </div>
                    <div class="current-rate-display">
                        <span class="current-label">Current Default Rate:</span>
                        <span class="current-value" id="currentDefaultRate">$25.00</span>
                    </div>
                    <div class="rate-actions">
                        <button class="btn btn-primary" onclick="saveDefaultRate()">ğŸ’¾ Save Default Rate</button>
                        <button class="btn btn-secondary" onclick="useDefaultRate()">ğŸ“ Use in Form</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3>â• Add New Student</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="studentName" placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Student ID *</label>
                            <input type="text" id="studentId" placeholder="S001">
                        </div>
                        <div class="form-group">
                            <label>Gender *</label>
                            <select id="studentGender">
                                <option value="">Select...</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="studentEmail" placeholder="john@example.com">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="studentPhone" placeholder="(555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label>Hourly Rate ($)</label>
                            <input type="number" id="studentBaseRate" step="0.01" min="0" placeholder="25.00">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addStudent()">â• Add Student</button>
                        <button class="btn btn-secondary" onclick="clearStudentForm()">ğŸ—‘ï¸ Clear Form</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3>ğŸ“‹ Student List</h3>
                    <div class="list-controls">
                        <div class="search-box">
                            <input type="search" id="studentSearch" placeholder="Search students..." oninput="filterStudents()">
                        </div>
                        <span class="auto-fill-hint">âœ¨ Type to filter</span>
                    </div>
                    <div id="studentsContainer" class="students-grid"></div>
                </div>
            </div>

            <!-- Hours Tab -->
            <div class="tab-content" id="hours">
                <div class="section-header">
                    <h2>â±ï¸ Hours Tracking</h2>
                    <div class="student-stats">
                        <span class="stat-badge" id="weeklyHours">0</span>
                        <span class="stat-divider">|</span>
                        <span class="stat-text">Weekly: <span id="weeklyTotal">$0.00</span></span>
                    </div>
                </div>

                <div class="section-card">
                    <h3>â• Log Work Hours</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Organization *</label>
                            <input type="text" id="organization" placeholder="ABC Company">
                        </div>
                        <div class="form-group">
                            <label>Work Type</label>
                            <select id="workType">
                                <option value="hourly">Hourly</option>
                                <option value="session">Per Session</option>
                                <option value="contract">Contract</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Subject</label>
                            <input type="text" id="subject" placeholder="Math, Science, etc.">
                        </div>
                        <div class="form-group">
                            <label>Topic</label>
                            <input type="text" id="topic" placeholder="Algebra, Physics, etc.">
                        </div>
                        <div class="form-group">
                            <label>Date *</label>
                            <input type="date" id="workDate">
                        </div>
                        <div class="form-group">
                            <label>Hours *</label>
                            <input type="number" id="hoursWorked" step="0.5" min="0" placeholder="2.5">
                        </div>
                        <div class="form-group">
                            <label>Rate ($/hour) *</label>
                            <input type="number" id="baseRate" step="0.01" min="0" placeholder="25.00">
                        </div>
                        <div class="form-group">
                            <label>Total Pay</label>
                            <input type="number" id="totalPay" readonly placeholder="Auto-calculated">
                        </div>
                        <div class="form-group full-width">
                            <label>Notes</label>
                            <textarea id="workNotes" rows="3" placeholder="Additional details..."></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="logHours()">ğŸ’¾ Log Work & Earnings</button>
                        <button class="btn btn-secondary" onclick="cancelHoursEdit()">ğŸ—‘ï¸ Clear Form</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3>ğŸ“‹ Recent Hours</h3>
                    <div id="hoursContainer" class="mobile-entries"></div>
                </div>
            </div>

            <!-- Marks Tab -->
            <div class="tab-content" id="marks">
                <div class="section-header">
                    <h2>ğŸ“ Marks & Assessments</h2>
                    <div class="student-stats">
                        <span class="stat-badge" id="marksCount">0</span>
                        <span class="stat-divider">|</span>
                        <span class="stat-text">Avg: <span id="avgMarks">0%</span></span>
                    </div>
                </div>

                <div class="section-card">
                    <h3>â• Record Assessment</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Student *</label>
                            <select id="marksStudent">
                                <option value="">Select student...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Subject *</label>
                            <input type="text" id="markSubject" placeholder="Mathematics">
                        </div>
                        <div class="form-group">
                            <label>Topic *</label>
                            <input type="text" id="markTopic" placeholder="Algebra">
                        </div>
                        <div class="form-group">
                            <label>Date *</label>
                            <input type="date" id="markDate">
                        </div>
                        <div class="form-group">
                            <label>Score *</label>
                            <input type="number" id="score" step="0.5" min="0" placeholder="85">
                        </div>
                        <div class="form-group">
                            <label>Maximum Score *</label>
                            <input type="number" id="maxScore" step="0.5" min="1" value="100">
                        </div>
                        <div class="form-group full-width">
                            <label>Comments</label>
                            <textarea id="markComments" rows="3" placeholder="Additional feedback..."></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addMark()">ğŸ’¾ Save Assessment</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('marksForm')?.reset()">ğŸ—‘ï¸ Clear</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3>ğŸ“‹ Recent Assessments</h3>
                    <div id="marksContainer" class="marks-list"></div>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div class="tab-content" id="attendance">
                <div class="section-header">
                    <h2>ğŸ“… Attendance Tracking</h2>
                    <div class="student-stats">
                        <span class="stat-badge" id="attendanceCount">0</span>
                        <span class="stat-divider">|</span>
                        <span class="stat-text">Last: <span id="lastSessionDate">Never</span></span>
                    </div>
                </div>

                <div class="section-card">
                    <h3>â• Record Attendance</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date *</label>
                            <input type="date" id="attendanceDate">
                        </div>
                        <div class="form-group">
                            <label>Subject *</label>
                            <input type="text" id="attendanceSubject" placeholder="Mathematics">
                        </div>
                        <div class="form-group">
                            <label>Topic</label>
                            <input type="text" id="attendanceTopic" placeholder="Algebra">
                        </div>
                    </div>

                    <div class="attendance-quick-actions">
                        <button class="select-all-btn" onclick="selectAllStudents()">âœ“ Select All</button>
                        <button class="deselect-all-btn" onclick="deselectAllStudents()">âœ— Deselect All</button>
                    </div>

                    <div class="attendance-container" id="attendanceList"></div>

                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="saveAttendance()">ğŸ’¾ Save Attendance</button>
                        <button class="btn btn-secondary" onclick="clearAttendanceForm()">ğŸ—‘ï¸ Clear</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3>ğŸ“‹ Recent Sessions</h3>
                    <div id="attendanceContainer" class="attendance-list"></div>
                </div>
            </div>

            <!-- Payments Tab -->
            <div class="tab-content" id="payments">
                <div class="section-header">
                    <h2>ğŸ’° Payments</h2>
                    <div class="student-stats">
                        <span class="stat-badge" id="totalStudentsCount">0</span>
                        <span class="stat-divider">|</span>
                        <span class="stat-text">Monthly: $<span id="monthlyPayments">0.00</span></span>
                    </div>
                </div>

                <div class="section-card">
                    <h3>â• Record Payment</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Student *</label>
                            <select id="paymentStudent">
                                <option value="">Select student...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount ($) *</label>
                            <input type="number" id="paymentAmount" step="0.01" min="0" placeholder="50.00">
                        </div>
                        <div class="form-group">
                            <label>Date *</label>
                            <input type="date" id="paymentDate">
                        </div>
                        <div class="form-group">
                            <label>Method</label>
                            <select id="paymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Debit Card">Debit Card</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="Check">Check</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>Notes</label>
                            <textarea id="paymentNotes" rows="2" placeholder="Payment details..."></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="recordPayment()">ğŸ’¾ Record Payment</button>
                        <button class="btn btn-secondary" onclick="resetPaymentForm()">ğŸ—‘ï¸ Clear</button>
                    </div>
                </div>

                <div class="section-card">
                    <h3>ğŸ“‹ Payment History</h3>
                    <div id="paymentActivityLog" class="payment-list"></div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-content" id="reports">
                <div class="section-header">
                    <h2>ğŸ“ˆ Reports & Analytics</h2>
                </div>

                <div class="section-card">
                    <div class="month-selector">
                        <label for="reportMonth">Select Month:</label>
                        <select id="reportMonth"></select>
                        <select id="reportYear"></select>
                        <button class="btn btn-sm" onclick="generateCurrentMonthReport()">ğŸ“… Current Month</button>
                    </div>
                </div>

                <div class="stats-row">
                    <div class="stat-card">
                        <h3>Total Students</h3>
                        <span id="totalStudentsReport">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total Hours</h3>
                        <span id="totalHoursReport">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total Earnings</h3>
                        <span id="totalEarningsReport">$0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Avg Mark</h3>
                        <span id="avgMarkReport">0%</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total Payments</h3>
                        <span id="totalPaymentsReport">$0</span>
                    </div>
                </div>

                <div class="section-card" id="breakdownContainer"></div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Spinner -->
    <div id="spinner" class="spinner">
        <div class="spinner-content">Loading...</div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script src="auth.js"></script>
    <script type="module">
        import { initializeApp } from 'firebase/app';
        import { getAuth, GoogleAuthProvider } from 'firebase/auth';
        import { getFirestore } from 'firebase/firestore';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAH4AAMhfBU52qLg6mjL0VHFAGx1OR4SAk",
            authDomain: "eventlog-e2243.firebaseapp.com",
            projectId: "eventlog-e2243",
            storageBucket: "eventlog-e2243.firebasestorage.app",
            messagingSenderId: "95089726888",
            appId: "1:95089726888:web:a7a577456aeebe10f4399d",
            measurementId: "G-RM4V4410ZN"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseProvider = provider;
        
        // Initialize cloud sync
        import('./cloud-sync.js').then(module => {
            window.cloudSync = module.cloudSync;
        });
    </script>
    <script>
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof init === 'function') init();
            
            // Set today's date in forms
            const today = new Date().toISOString().split('T')[0];
            ['workDate', 'attendanceDate', 'markDate', 'paymentDate'].forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.value) el.value = today;
            });
        });
    </script>
    <style>
        .spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .spinner.active {
            display: flex;
        }
        
        .spinner-content {
            background: white;
            padding: 20px 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            background: #333;
            color: white;
            padding: 12px 20px;
            margin-top: 10px;
            border-radius: 6px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.success { background: #28a745; }
        .toast.error { background: #dc3545; }
        .toast.info { background: #17a2b8; }
        
        .user-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            min-width: 200px;
            z-index: 1000;
        }
        
        .user-menu.show {
            display: block;
        }
        
        .user-info {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-weight: bold;
        }
        
        .user-menu-item {
            width: 100%;
            padding: 10px 12px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
        }
        
        .user-menu-item:hover {
            background: #f5f5f5;
        }
    </style>
</body>
</html>
